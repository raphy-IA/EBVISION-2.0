<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nettoyage du Cache</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/vendor/fontawesome/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .btn-clear {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }
        .btn-clear:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body text-center p-5">
                        <i class="fas fa-broom fa-4x text-primary mb-4"></i>
                        <h2 class="card-title mb-4">Nettoyage du Cache</h2>
                        <p class="text-muted mb-4">
                            Cette opération va supprimer toutes les données en cache (tokens, préférences, etc.) 
                            et vous reconnecter avec les nouvelles configurations.
                        </p>
                        
                        <div id="status" class="alert alert-info mb-4" style="display: none;">
                            <i class="fas fa-spinner fa-spin me-2"></i>
                            <span id="statusText">Nettoyage en cours...</span>
                        </div>
                        
                        <div id="success" class="alert alert-success mb-4" style="display: none;">
                            <i class="fas fa-check-circle me-2"></i>
                            Cache nettoyé avec succès ! Redirection vers la page de connexion...
                        </div>
                        
                        <button id="clearBtn" class="btn btn-clear btn-lg">
                            <i class="fas fa-broom me-2"></i>
                            Nettoyer le Cache
                        </button>
                        
                        <div class="mt-4">
                            <a href="/login.html" class="text-muted">
                                <i class="fas fa-arrow-left me-2"></i>
                                Retour à la connexion
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-body">
                        <h6 class="card-title">
                            <i class="fas fa-info-circle me-2"></i>
                            Pourquoi nettoyer le cache ?
                        </h6>
                        <ul class="small text-muted mb-0">
                            <li>Mise à jour du système de rôles multiples</li>
                            <li>Nouveaux tokens JWT avec format mis à jour</li>
                            <li>Résolution des problèmes de permissions</li>
                            <li>Accès complet pour les SUPER_ADMIN</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('clearBtn').addEventListener('click', function() {
            const btn = this;
            const status = document.getElementById('status');
            const success = document.getElementById('success');
            const statusText = document.getElementById('statusText');
            
            btn.disabled = true;
            status.style.display = 'block';
            
            // Simuler le processus de nettoyage
            setTimeout(() => {
                statusText.textContent = 'Suppression du localStorage...';
            }, 300);
            
            setTimeout(() => {
                // Nettoyer localStorage
                localStorage.clear();
                statusText.textContent = 'Suppression du sessionStorage...';
            }, 600);
            
            setTimeout(() => {
                // Nettoyer sessionStorage
                sessionStorage.clear();
                statusText.textContent = 'Suppression des cookies...';
            }, 900);
            
            setTimeout(() => {
                // Supprimer les cookies
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                
                status.style.display = 'none';
                success.style.display = 'block';
            }, 1200);
            
            setTimeout(() => {
                // Rediriger vers la page de connexion
                window.location.href = '/login.html';
            }, 2500);
        });
    </script>
</body>
</html>












